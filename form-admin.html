<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin — Tambah Produk</title>
  <style>
    body{font-family:Arial, sans-serif;background:#ffe6ef;margin:0;padding:28px}
    .wrap{max-width:620px;margin:24px auto}
    h1{text-align:center;color:#c81f6a}
    form{background:#fff;padding:20px;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,0.08)}
    label{display:block;margin-top:12px;font-weight:700}
    input[type="text"], input[type="url"], textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #ddd;margin-top:6px}
    input[type="file"]{margin-top:8px}
    button{margin-top:14px;background:#ff7a00;color:#fff;padding:10px 16px;border:0;border-radius:10px;cursor:pointer;font-weight:700}
    .msg{margin-top:12px;text-align:center}
    .small{font-size:13px;color:#666;margin-top:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Tambah Produk — Admin</h1>
    <form id="frm" enctype="multipart/form-data">
      <label>Nama Produk</label>
      <input type="text" name="name" required>

      <label>Deskripsi</label>
      <textarea name="desc" rows="3" required></textarea>

      <label>Link (contoh: Shopee)</label>
      <input type="url" name="link" placeholder="https://..." required>

      <label>Gambar (jpg/png) — akan diupload ke folder WEB/ di repo</label>
      <input type="file" name="image" accept="image/*" required>

      <div class="small">ID akan terisi otomatis sesuai jumlah produk saat ini di katalog.</div>

      <button type="submit">Upload & Tambah Produk</button>
    </form>

    <div id="msg" class="msg"></div>
  </div>

  <script>
    const form = document.getElementById('frm');
    const msg = document.getElementById('msg');

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      msg.textContent = 'Mengunggah...';
      const fd = new FormData(form);

      try{
        // Jika Replit memberikan domain mis. https://my-app.username.repl.co
        // Pastikan fetch ke domain yang sama. Di Replit, gunakan relative path '/api/add-product'
        const res = await fetch('/api/add-product', {
          method: 'POST',
          body: fd
        });

        const j = await res.json();
        if(res.ok){
          msg.innerHTML = `<span style="color:green">Berhasil! Produk ID: ${j.id}</span>`;
          form.reset();
        } else {
          console.error(j);
          msg.innerHTML = `<span style="color:red">Gagal: ${j.message || JSON.stringify(j)}</span>`;
        }
      } catch(err){
        console.error(err);
        msg.innerHTML = `<span style="color:red">Terjadi kesalahan jaringan.</span>`;
      }
    });
  </script>
</body>
</html>
